<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Shree Ji Tech | Enterprise</title>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
:root{
--red:#ff4d6d;
--green:#22c55e;
--bg:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
--glass:rgba(255,255,255,0.05);
}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif}
body{background:var(--bg);color:white;padding-bottom:100px}
header{background:rgba(0,0,0,.4);padding:12px;display:flex;justify-content:space-between;align-items:center}
.logo-area{display:flex;align-items:center;gap:10px}
.logo-area img{height:50px;width:50px;border-radius:50%;border:2px solid var(--red)}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:15px;padding:15px}
.card{background:var(--glass);padding:15px;border-radius:16px;text-align:center}
.card img{height:90px;width:100%;object-fit:contain}
.price{color:var(--green);font-weight:bold;margin:5px 0}
.btn{background:linear-gradient(45deg,var(--red),#ff758f);border:none;padding:10px;border-radius:10px;color:white;font-weight:bold;margin:4px 0;width:100%;cursor:pointer}
input{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:none;background:#1e293b;color:white}
</style>
</head>
<body>

<header>
<div class="logo-area">
<img src="1000007701.jpg">
<div>
<b>SHREE JI TECH</b>
<p id="welcomeMsg" style="font-size:10px">Welcome Guest</p>
</div>
</div>
<div>
<button id="logoutBtn" class="btn" style="display:none;background:#444;width:auto" onclick="logoutUser()">Logout</button>
</div>
</header>

<!-- MOBILE LOGIN BOX -->
<div id="loginBox" style="position:fixed;top:10px;right:10px;width:270px;background:#111827;padding:15px;border-radius:10px;z-index:1000">

<h4>Mobile Login</h4>
<input id="phone" value="+91" onfocus="if(this.value=='+91')this.setSelectionRange(3,3)">
<div id="recaptcha-container"></div>
<button class="btn" onclick="sendOTP()">Send OTP</button>

</div>

<div class="grid" id="productGrid"></div>

<script>
firebase.initializeApp({
apiKey:"AIzaSyBuCywyMgEw_j9yeHD-E4KwRWZGreWagTc",
authDomain:"shree-4c33e.firebaseapp.com",
projectId:"shree-4c33e"
});

const db=firebase.firestore();
const ADMIN_PHONE="+919999999999"; // ðŸ‘ˆ apna admin number daal do

let currentUser=null;
let selectedProduct=null;
let confirmationResult=null;

/* AUTH STATE */
firebase.auth().onAuthStateChanged(user=>{
if(user){
currentUser=user.phoneNumber;
loginBox.style.display="none";
logoutBtn.style.display="block";
welcomeMsg.innerText="Logged in: "+currentUser;
}
loadProducts();
});

/* RECAPTCHA */
window.recaptchaVerifier=new firebase.auth.RecaptchaVerifier('recaptcha-container',{size:'normal'});

/* SEND OTP */
function sendOTP(){
let ph=phone.value.trim();

if(!ph.startsWith("+91")||ph.length<13){
alert("Enter valid number");
return;
}

firebase.auth().signInWithPhoneNumber(ph,window.recaptchaVerifier)
.then(result=>{
confirmationResult=result;
let otp=prompt("Enter OTP");
if(!otp)return;

confirmationResult.confirm(otp)
.catch(()=>alert("Invalid OTP"));
})
.catch(e=>alert(e.message));
}

/* LOGOUT */
function logoutUser(){
firebase.auth().signOut();
location.reload();
}

/* PRODUCTS */
function loadProducts(){
db.collection("products").onSnapshot(s=>{
productGrid.innerHTML="";
s.forEach(doc=>{
let p=doc.data();

let btn="";
if(currentUser===ADMIN_PHONE){
btn=`<button class="btn" onclick="deleteProduct('${doc.id}')">Delete</button>`;
}else{
btn=`<button class="btn" onclick="buyProduct('${doc.id}',${p.stock||0})">Buy</button>
<p>Stock: ${p.stock||0}</p>`;
}

productGrid.innerHTML+=`
<div class="card">
<img src="${p.img||''}">
<p>${p.name}</p>
<div class="price">â‚¹${p.price}</div>
${btn}
</div>`;
});
});
}

function buyProduct(id,stock){

if(currentUser===ADMIN_PHONE){
alert("Admin cannot buy");
return;
}

if(stock<=0){
alert("Out of stock");
return;
}

db.collection("products").doc(id).get().then(doc=>{
selectedProduct={id:doc.id,...doc.data()};
placeOrder();
});
}

function placeOrder(){
db.collection("orders").add({
orderId:"ORD"+Date.now(),
user:currentUser,
product:selectedProduct.name,
price:selectedProduct.price,
status:"Pending",
date:Date.now()
});

db.collection("products").doc(selectedProduct.id)
.update({stock:firebase.firestore.FieldValue.increment(-1)});

alert("Order Placed");
}

/* ADMIN DELETE */
function deleteProduct(id){
db.collection("products").doc(id).delete();
}
</script>

</body>
</html>
